---
keyword: [NAT网关, 增强型, 网络地址转换, 提供公网服务, 访问公网]
---

# 使用SNAT访问公网

本教程指导您配置NAT网关的SNAT功能，实现无公网IP的ECS实例通过NAT网关访问互联网。

## 配置场景

本教程以下图场景为例。某公司在阿里云创建了VPC和交换机，交换机中创建了多个ECS实例。ECS实例均未分配固定公网IP，也未绑定弹性公网IP。因公司业务发展，需要每台ECS实例都需要访问互联网。

您可以通过NAT网关的SNAT功能，为VPC内无公网IP的ECS实例提供访问互联网的代理服务。

![SNAT配置场景](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/1371359951/p149166.png)

## 前提条件

-   您已经注册了阿里云账号。具体操作，请参见[账号注册](https://account.alibabacloud.com/register/intl_register.htm)。
-   您已经创建了专有网络VPC和交换机。具体操作，请参见[创建专有网络](/intl.zh-CN/专有网络和交换机/管理专有网络/创建专有网络.md)。

## 配置步骤

![配置步骤](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/1371359951/p149588.png)

## 步骤一：创建NAT网关

1.  登录[NAT网关管理控制台](https://vpc.console.aliyun.com/nat)。

2.  在**NAT网关**页面，单击**创建NAT网关**。

3.  首次购买增强型NAT网关时，您需要在**创建NAT网关**面板最下方的关联角色创建须知区域，单击**创建**，完成NAT网关的服务关联角色创建。角色创建成功后即可购买NAT网关。

4.  在**创建NAT网关**面板，配置以下购买信息，然后单击**立即购买**。

    -   **地域和可用区**：选择需要创建NAT网关的地域。
    -   **可用区**：选择NAT网关实例所属的可用区。
    -   **VPC ID**：选择NAT网关所属的VPC。创建NAT网关后，不能修改NAT网关所属的VPC。

        **说明：** 如果在VPC列表中，找不到目标VPC，请排查是否有以下情况：

        -   在选择地域内没有VPC。
        -   查看该VPC中是否存在目标网段为0.0.0.0/0的自定义路由。如果存在，请删除该路由条目。
        -   RAM账号不具备读取访问VPC的权限，请联系主账号进行授权。
    -   **交换机ID**：选择NAT网关实例所属的交换机。
    -   **网关类型**：默认选择为**增强型**。

        增强型NAT网关兼容普通型NAT网关的全部功能，并在普通型NAT网关的技术架构上作了升级，具有更优的弹性和更强的稳定性，帮助您更好的管理公网访问流量。

    -   **计费类型**
        -   **按使用量计费**：按NAT网关实际使用量收费，更多信息，请参见[t16029.md\#section\_v5g\_sue\_5bj](/intl.zh-CN/购买指南/按量付费.md)。
        -   **按固定规格计费**：每个计费周期的费用固定，不会因NAT网关的处理量发生变化。选择该计费类型后，需要选择**规格**。

            NAT网关的规格会影响SNAT功能的最大连接数和每秒新建连接数，但不会影响DNAT性能。更多信息，请参见[实例规格]()。

    -   **计费类型**：选择NAT网关实例的计费类型。

        目前，仅支持按固定规格计费。更多信息，请参见[按固定规格计费](/intl.zh-CN/购买指南/按量付费.md)。

    -   **计费周期**：显示NAT网关实例的计费周期。
5.  在支付订单页面确认支付金额，然后单击**支付**完成购买。

    当出现**恭喜，支付成功！**的提示后，说明您购买成功。


创建成功后，您可以在**NAT网关**页面查看已创建的NAT网关实例。

![创建NAT网关](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/2007960161/p224758.png)

## 步骤二：创建并绑定EIP

NAT网关作为一个网关设备，需要绑定公网IP才能正常工作。创建NAT网关后，您可以为NAT网关创建并绑定EIP。

1.  登录[NAT网关管理控制台](https://vpc.console.aliyun.com/nat)。

2.  在顶部菜单栏处，选择NAT网关的地域。

3.  在**NAT网关**页面，找到目标NAT网关实例，单击**弹性公网IP**列下的**立即绑定**。

4.  在绑定弹性公网IP对话框，配置以下参数，然后单击**确定**。

    |配置|说明|
    |--|--|
    |**所在资源组**|选择EIP所在的资源组。|
    |**选择弹性公网IP**|选择**新购弹性公网IP并绑定**要绑定到NAT网关的EIP。系统为您创建1个按使用流量计费的按量付费EIP，并绑定到NAT网关。 |

    绑定成功后，在NAT网关实例的**弹性公网IP**列将会显示出绑定的公网IP。


## 步骤三：创建SNAT条目

NAT网关的SNAT功能可以为VPC中无公网IP的ECS实例提供访问互联网的代理服务。

1.  登录[NAT网关管理控制台](https://vpc.console.aliyun.com/nat)。

2.  在顶部菜单栏处，选择NAT网关的地域。

3.  在**NAT网关**页面，找到目标NAT网关实例，单击**操作**列下的**设置SNAT**。

4.  在**SNAT管理**页签，单击**创建SNAT条目**。

5.  在**创建SNAT条目**页面，配置以下参数，然后单击**确定创建**。

    |配置|说明|
    |:-|:-|
    |**SNAT条目粒度**|选择SNAT条目的粒度。本文以选择**交换机粒度**为例：指定交换机下的ECS实例通过配置的公网IP访问互联网。    -   **选择交换机**：在下拉列表中选择交换机。如果下拉列表中没有可选的交换机，可在下拉列表单击**创建交换机**跳转到VPC控制台创建交换机。

**说明：** 如您选择多个交换机，将会为您创建多条SNAT条目，使用相同的公网IP地址。

    -   **交换机网段**：显示交换机的网段。 |
    |**选择公网IP地址**|选择用来提供互联网访问的公网IP。本文以选择**使用单IP**为例，在下拉列表中选择弹性公网IP。如果下拉列表中没有可选的弹性公网IP，可在下拉列表单击**新购弹性公网IP并绑定**购买弹性公网IP。|
    |**条目名称**|输入SNAT条目的名称。 名称长度为2~128个字符，以大小写字母或中文开头， 可包含数字、下划线（\_）和短划线（-）。 |


## 步骤四：测试连通性

SNAT条目配置成功后，您可以测试ECS实例的网络连通性。本教程以Linux实例为例，测试ECS实例的连通性。

**说明：** 请确保ECS实例的安全组规则允许ECS实例访问互联网，安全组的配置规则请参见[安全组概述](/intl.zh-CN/安全/安全组/安全组概述.md)。

1.  登录交换机下的任意一台ECS实例。

2.  通过`ping`命令测试网络连通性。

    经测试，ECS实例可以访问互联网。

    ![测试连通性](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/1371359951/p149291.png)


