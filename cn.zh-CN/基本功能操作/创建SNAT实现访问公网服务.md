---
keyword: [NAT网关, 增强型, 网络地址转换, 提供公网服务, 访问公网]
---

# 创建SNAT实现访问公网服务

您可以使用NAT网关的SNAT功能，为VPC中无公网IP的ECS实例提供访问互联网的代理服务。

## 使用限制

SNAT IP地址池中的公网IP具有以下限制：

-   普通型NAT网关每个公网IP的最大带宽限制为200 Mbps。
-   每个公网IP的最大连接数为55000个。

为了使SNAT规则能充分利用共享带宽的带宽能力，及避免公网IP过少导致端口冲突，建议您按照以下配比关系添加公网IP：

-   共享带宽的带宽峰值为1024 Mbps时，普通型NAT网关中的SNAT规则中的公网IP数量应至少为5个。
-   共享带宽的带宽峰值以1024 Mbps为基础每增加200 Mbps，普通型NAT网关中的SNAT规则中都应至少再新增1个公网IP。

如果ECS实例已经持有了公网IP（例如分配了固定公网IP、绑定弹性公网IP和设置了DNAT IP映射），当该ECS实例发起互联网访问时，会优先通过持有的公网IP访问互联网，而不会使用NAT网关的SNAT功能访问互联网。如需统一公网出口IP，请参见[为已分配固定公网IP的ECS实例统一公网出口IP](/cn.zh-CN/最佳实践/统一公网出口IP/为已分配固定公网IP的ECS实例统一公网出口IP.md)和[为设置了DNAT IP映射的ECS实例统一公网出口IP](/cn.zh-CN/最佳实践/统一公网出口IP/为设置了DNAT IP映射的ECS实例统一公网出口IP.md)。

增强型NAT网关支持将一个公网IP同时用于DNAT条目和SNAT条目。

## 前提条件

创建SNAT条目前，请确保满足以下条件：

-   您已经创建了NAT网关并绑定了弹性公网IP。具体操作，请参见[创建NAT网关](/cn.zh-CN/购买指南/购买NAT网关.md)和[绑定弹性公网IP](/cn.zh-CN/基本功能操作/创建NAT网关实例.md)。

    **说明：** 如果您在2017年11月03日之前购买过NAT带宽包，请确保NAT带宽包中有可用的公网IP。

-   如果要创建以交换机为粒度的SNAT条目，请确保NAT网关关联的VPC中已经创建了交换机。具体操作，请参见[创建交换机](/cn.zh-CN/专有网络和交换机/使用交换机.md)。
-   如果要创建以ECS为粒度的SNAT条目，请确保NAT网关关联的VPC中已经创建了ECS实例。具体操作，请参见[使用向导创建实例](/cn.zh-CN/实例/创建实例/使用向导创建实例.md)。

## 创建SNAT条目

1.  登录[NAT网关管理控制台](https://vpc.console.aliyun.com/nat)。

2.  在顶部菜单栏处，选择NAT网关的地域。

3.  在**NAT网关**页面，找到目标NAT网关实例，单击**操作**列下的**设置SNAT**。

4.  在**SNAT管理**页签，单击**创建SNAT条目**。

5.  在**创建SNAT条目**页面，配置以下参数，然后单击**确定创建**。

    |配置|说明|
    |:-|:-|
    |**SNAT条目粒度**|选择SNAT条目的粒度。    -   **交换机粒度**：指定交换机下的ECS实例通过配置的公网IP访问互联网。
        -   **选择交换机**：在下拉列表中选择交换机。如果下拉列表中没有可选的交换机，可在下拉列表单击**创建交换机**跳转到VPC控制台创建交换机。

**说明：** 如您选择多个交换机，将会为您创建多条SNAT条目，使用相同的公网IP地址。

        -   **交换机网段**：显示交换机的网段。
    -   **ECS粒度**：指定的ECS实例通过配置的公网IP访问互联网。
        -   **选择ECS**：在下拉列表中选择ECS。该ECS实例将通过配置的公网IP访问互联网。请确保ECS实例满足以下条件：

            -   ECS实例的状态处于运行中。
            -   ECS实例不具备固定公网IP且未绑定其他弹性公网IP。
**说明：**

            -   如果下拉列表中没有可选的ECS，可在下拉列表单击**创建ECS**跳转到ECS控制台进行创建。
            -   如您选择多个ECS，将会为您创建多条SNAT条目，使用相同的公网IP地址。
        -   **ECS网段**：显示ECS实例的网段。 |
    |**选择公网IP地址**|选择用来提供互联网访问的公网IP。     -   **使用单IP**：在下拉列表中选择弹性公网IP。如果下拉列表中没有可选的弹性公网IP，可在下拉列表单击**新购弹性公网IP并绑定**，在弹出的对话框中完成弹性公网IP的购买操作。
    -   **使用多IP**：多个IP地址配置至SNAT IP地址池时，请确保所选IP地址在一个共享带宽中。当VPC ECS实例主动发起对外的访问连接时，VPC ECS实例会随机通过SNAT地址池中的公网IP地址访问互联网。
        -   **共享带宽**：在下拉列表选择共享带宽。如果下拉列表中没有可选的共享带宽，可在下拉列表单击**创建共享带宽**，在共享带宽购买页完成购买。
        -   **公网IP**：在下拉列表选择已经被加入到选定共享带宽中的弹性公网IP。 |
    |**条目名称**|SNAT条目的名称。 名称长度为2~128个字符，以大小写字母或中文开头， 可包含数字、下划线（\_）和短划线（-）。 |


## 编辑SNAT条目

创建SNAT条目后，您可以修改SNAT条目的公网IP和名称，但您不能修改SNAT条目的交换机和ECS实例。

1.  登录[NAT网关管理控制台](https://vpc.console.aliyun.com/nat)。

2.  在顶部菜单栏处，选择NAT网关的地域。

3.  在**NAT网关**页面，找到目标NAT网关实例，单击**操作**列下的**设置SNAT**。

4.  在**SNAT条目列表**区域，找到目标SNAT条目，单击**操作**列下的**编辑**。

5.  在**编辑SNAT条目**页面，修改SNAT条目的公网IP或名称，然后单击**确定修改**。

    **说明：** 向存量SNAT条目添加或删除弹性公网IP会导致原有连接闪断，重连可以恢复，请谨慎操作。


## 移除SNAT条目

如果您不需要为VPC内无公网IP的ECS实例提供访问互联网的代理服务，您可以删除SNAT条目。

1.  登录[NAT网关管理控制台](https://vpc.console.aliyun.com/nat)。

2.  在顶部菜单栏处，选择NAT网关的地域。

3.  在**NAT网关**页面，找到目标NAT网关实例，单击**操作**列下的**设置SNAT**。

4.  在**SNAT条目列表**区域，找到目标SNAT条目，单击**操作**列下的**移除**。

5.  在弹出的对话框中，单击**确定**。


**相关文档**  


[CreateSnatEntry](/cn.zh-CN/API参考/NAT网关/CreateSnatEntry.md)

[ModifySnatEntry](/cn.zh-CN/API参考/NAT网关/ModifySnatEntry.md)

[DeleteSnatEntry](/cn.zh-CN/API参考/NAT网关/DeleteSnatEntry.md)

