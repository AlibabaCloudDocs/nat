# 创建DNAT提供公网服务

NAT网关支持DNAT功能，将NAT网关上的公网IP映射给ECS实例使用，使ECS实例能够提供互联网服务。DNAT支持端口映射和IP映射。

## 背景信息

如果您的ECS实例已经绑定了EIP，则不支持为该ECS实例添加DNAT条目。

如需为该ECS实例添加DNAT条目，请先将ECS实例与EIP解绑。解绑后，再为该ECS实例添加DNAT条目。解绑的具体操作，请参见[解绑EIP](/intl.zh-CN/用户指南/解绑EIP.md)。

**说明：** 如果存量ECS实例绑定了EIP，且处于NAT网关的DNAT条目中，则ECS实例优先通过绑定的EIP进行公网通信。

## 前提条件

您已经创建了NAT网关并绑定了弹性公网IP（EIP）。具体操作，请参见[创建NAT网关]()和[绑定弹性公网IP]()。

**说明：** 如果您在2018年1月26日之前购买过NAT带宽包，请确保NAT带宽包中有可用的公网IP。

## 创建DNAT条目

1.  登录[NAT网关管理控制台](https://vpc.console.aliyun.com/nat)。

2.  在顶部菜单栏处，选择NAT网关的地域。

3.  在**NAT网关**页面，找到目标NAT网关实例，单击**操作**列下的**设置DNAT**。

4.  在**DNAT管理**页签，单击**创建DNAT条目**。

5.  在**创建DNAT条目**页面，配置以下参数，然后单击**确定创建**。

    |配置|说明|
    |:-|:-|
    |**选择公网IP地址**|选择要提供互联网通信的公网IP。 **说明：** 增强型NAT网关白名单支持将一个公网IP同时用于DNAT条目和SNAT条目。如需使用，请[提交工单](https://workorder-intl.console.aliyun.com/#/ticket/createIndex)。 |
    |**选择私网IP地址**|选择要通过DNAT规则进行公网通信的ECS实例。您可以通过以下两种方式指定目标ECS实例的私网IP：     -   **从ECS或弹性网卡对应IP进行选择**：从ECS实例或弹性网卡列表中选择ECS实例。
    -   **通过手动输入**：输入目标ECS实例的私网IP。

**说明：** 自填的私网IP必须属于本VPC的CIDR范围，也可直接输入一个已有的ECS实例的私网IP。 |
    |**端口设置**|选择DNAT映射的方式：     -   **任意端口**：该方式属于IP映射，任何访问该公网IP的请求都将转发到目标ECS实例上。
    -   **具体端口**：该方式属于端口映射，NAT网关会将以指定协议和端口访问该公网IP的请求转发到目标ECS实例的指定端口上。

选择具体端口后，请根据业务需求设置以下参数：

        -   **公网端口**：进行端口转发的外部端口。
        -   **私网端口**：进行端口转发的内部端口。
        -   **协议类型**：转发端口的协议类型。 |
    |**条目名称**|输入DNAT条目的名称。 名称长度为2~128个字符，以大小写字母或中文开头， 可包含数字、下划线（\_）和短横线（-）。 |


## 编辑DNAT条目

创建DNAT条目后，您可以修改DNAT条目的公网IP、私网IP、端口和名称。

1.  登录[NAT网关管理控制台](https://vpc.console.aliyun.com/nat)。

2.  在顶部菜单栏处，选择NAT网关的地域。

3.  在**NAT网关**页面，找到目标NAT网关实例，单击**操作**列下的**设置DNAT**。

4.  在**DNAT条目列表**区域，找到目标DNAT条目，单击**操作**列下的**编辑**。

5.  在**编辑DNAT条目**页面，修改DNAT条目的公网IP、私网IP、端口和名称，然后单击**确定修改**。


## 删除DNAT条目

如果您不需要ECS实例面向互联网提供服务，您可以删除DNAT条目。

1.  登录[NAT网关管理控制台](https://vpc.console.aliyun.com/nat)。

2.  在顶部菜单栏处，选择NAT网关的地域。

3.  在**NAT网关**页面，找到目标NAT网关实例，单击**操作**列下的**设置DNAT**。

4.  在DNAT条目列表区域，找到目标DNAT条目，单击**操作**列下的**删除**。

5.  在弹出的对话框中，单击**确定**。


**相关文档**  


[CreateForwardEntry](/intl.zh-CN/API参考/NAT网关/CreateForwardEntry.md)

[ModifyForwardEntry](/intl.zh-CN/API参考/NAT网关/ModifyForwardEntry.md)

[DeleteForwardEntry](/intl.zh-CN/API参考/NAT网关/DeleteForwardEntry.md)

